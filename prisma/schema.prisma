// Messenger Bulk Messaging Platform Database Schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================
// ORGANIZATION & USER MANAGEMENT
// ============================================

model Organization {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  users         User[]
  contacts      Contact[]
  campaigns     Campaign[]
  templates     Template[]
  facebookPages FacebookPage[]
  pipelines     Pipeline[]
  tags          Tag[]
  teams         Team[]
}

model User {
  id             String       @id @default(cuid())
  email          String       @unique
  password       String?
  name           String?
  image          String?
  role           Role         @default(AGENT)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Current active context
  activeTeamId   String?
  
  campaigns      Campaign[]
  conversations  Conversation[]
  activities     ContactActivity[]
  
  // Team relations
  ownedTeams     Team[]       @relation("TeamOwner")
  teamMemberships TeamMember[]
  createdInvites TeamInvite[]
  joinRequests   TeamJoinRequest[]
  reviewedRequests TeamJoinRequest[] @relation("ReviewedRequests")
  broadcasts     TeamBroadcast[]
}

enum Role {
  ADMIN
  MANAGER
  AGENT
}

// ============================================
// FACEBOOK & INSTAGRAM INTEGRATION
// ============================================

model FacebookPage {
  id                  String       @id @default(cuid())
  organizationId      String
  organization        Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  // Facebook Page
  pageId              String       @unique
  pageName            String
  pageAccessToken     String       // Should be encrypted in production
  
  // Instagram Business (connected to page)
  instagramAccountId  String?      @unique
  instagramUsername   String?
  
  // Sync settings
  autoSync            Boolean      @default(true)
  syncInterval        Int          @default(3600) // seconds
  lastSyncedAt        DateTime?
  
  // Auto-pipeline assignment settings
  autoPipelineId      String?
  autoPipeline        Pipeline?    @relation(fields: [autoPipelineId], references: [id], onDelete: SetNull)
  autoPipelineMode    AutoPipelineMode @default(SKIP_EXISTING)
  
  isActive            Boolean      @default(true)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  
  contacts            Contact[]
  conversations       Conversation[]
  campaigns           Campaign[]
  teamPermissions     TeamMemberPermission[]
}

enum AutoPipelineMode {
  SKIP_EXISTING     // Only assign new contacts without pipeline
  UPDATE_EXISTING   // Re-evaluate and update all contacts
}

// ============================================
// CONTACTS & TAGS
// ============================================

model Contact {
  id             String       @id @default(cuid())
  
  // Platform identifiers
  messengerPSID  String?      // Page-Scoped ID for Messenger
  instagramSID   String?      // Instagram-Scoped ID
  
  // Contact info from Graph API
  firstName      String
  lastName       String?
  profilePicUrl  String?
  locale         String?
  timezone       Int?
  
  // Which platforms they're on
  hasMessenger   Boolean      @default(false)
  hasInstagram   Boolean      @default(false)
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  facebookPageId String
  facebookPage   FacebookPage @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)
  
  // Pipeline tracking
  pipelineId     String?
  pipeline       Pipeline?    @relation(fields: [pipelineId], references: [id], onDelete: SetNull)
  
  stageId        String?
  stage          PipelineStage? @relation(fields: [stageId], references: [id], onDelete: SetNull)
  
  stageEnteredAt DateTime?
  
  // Lead scoring
  leadScore      Int          @default(0)
  leadStatus     LeadStatus   @default(NEW)
  
  tags           String[]
  notes          String?      @db.Text
  aiContext      String?      @db.Text
  aiContextUpdatedAt DateTime?
  lastInteraction DateTime?
  
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  groups         ContactGroup[]
  messages       Message[]
  conversations  Conversation[]
  activities     ContactActivity[]
  
  @@unique([messengerPSID, facebookPageId])
  @@index([instagramSID])
  @@index([pipelineId, stageId])
  @@index([leadStatus])
  @@index([organizationId])
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  NEGOTIATING
  WON
  LOST
  UNRESPONSIVE
}

model Tag {
  id             String   @id @default(cuid())
  name           String
  description    String?
  color          String   @default("#64748b")
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  contactCount   Int      @default(0)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@unique([organizationId, name])
  @@index([organizationId])
}

model ContactGroup {
  id          String    @id @default(cuid())
  name        String
  description String?
  color       String?
  contacts    Contact[]
  campaigns   Campaign[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ============================================
// PIPELINE SYSTEM
// ============================================

model Pipeline {
  id             String   @id @default(cuid())
  name           String
  description    String?
  color          String   @default("#3b82f6")
  icon           String?
  isDefault      Boolean  @default(false)
  isArchived     Boolean  @default(false)
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  stages         PipelineStage[]
  contacts       Contact[]
  automations    PipelineAutomation[]
  facebookPages  FacebookPage[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@index([organizationId, isArchived])
}

model PipelineStage {
  id          String   @id @default(cuid())
  name        String
  description String?
  color       String   @default("#64748b")
  order       Int
  
  type        StageType @default(IN_PROGRESS)
  
  pipelineId  String
  pipeline    Pipeline @relation(fields: [pipelineId], references: [id], onDelete: Cascade)
  
  contacts    Contact[]
  activities  ContactActivity[] @relation("toStage")
  fromActivities ContactActivity[] @relation("fromStage")
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([pipelineId, order])
  @@index([pipelineId])
}

enum StageType {
  LEAD
  IN_PROGRESS
  WON
  LOST
  ARCHIVED
}

model ContactActivity {
  id          String   @id @default(cuid())
  
  contactId   String
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  
  type        ActivityType
  
  title       String
  description String?
  metadata    Json?
  
  fromStageId String?
  fromStage   PipelineStage? @relation(fields: [fromStageId], references: [id], name: "fromStage", onDelete: SetNull)
  
  toStageId   String?
  toStage     PipelineStage? @relation(fields: [toStageId], references: [id], name: "toStage", onDelete: SetNull)
  
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  createdAt   DateTime @default(now())
  
  @@index([contactId, createdAt])
  @@index([type])
}

enum ActivityType {
  NOTE_ADDED
  STAGE_CHANGED
  STATUS_CHANGED
  TAG_ADDED
  MESSAGE_SENT
  MESSAGE_RECEIVED
  CAMPAIGN_SENT
  TASK_CREATED
  TASK_COMPLETED
  CALL_MADE
  EMAIL_SENT
}

model PipelineAutomation {
  id          String   @id @default(cuid())
  name        String
  description String?
  isActive    Boolean  @default(true)
  
  pipelineId  String
  pipeline    Pipeline @relation(fields: [pipelineId], references: [id], onDelete: Cascade)
  
  triggerType AutomationTrigger
  triggerConditions Json
  
  actions     Json
  
  timesTriggered Int    @default(0)
  lastTriggeredAt DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([pipelineId, isActive])
}

enum AutomationTrigger {
  STAGE_ENTERED
  STAGE_DURATION
  MESSAGE_RECEIVED
  NO_ACTIVITY
  TAG_ADDED
  LEAD_SCORE_REACHED
}

// ============================================
// CAMPAIGNS & TEMPLATES
// ============================================

model Campaign {
  id             String       @id @default(cuid())
  name           String
  description    String?
  status         CampaignStatus @default(DRAFT)
  
  platform       Platform
  messageTag     MessageTag?
  
  facebookPageId String
  facebookPage   FacebookPage @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)
  
  scheduledAt    DateTime?
  startedAt      DateTime?
  completedAt    DateTime?
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  createdById    String
  createdBy      User         @relation(fields: [createdById], references: [id])
  
  templateId     String?
  template       Template?    @relation(fields: [templateId], references: [id], onDelete: SetNull)
  
  targetingType  TargetingType @default(CONTACT_GROUPS)
  
  groups         ContactGroup[]
  targetContactIds String[]
  targetTags     String[]
  targetStageIds String[]
  targetFilters  Json?
  
  rateLimit      Int          @default(3600) // 1 message per second (3600/hour) - was 100 which caused 36 second delays
  
  totalRecipients Int         @default(0)
  sentCount       Int         @default(0)
  deliveredCount  Int         @default(0)
  readCount       Int         @default(0)
  failedCount     Int         @default(0)
  repliedCount    Int         @default(0)
  
  messages       Message[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  @@index([status, platform])
  @@index([organizationId])
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  PAUSED
  CANCELLED
  COMPLETED
}

enum TargetingType {
  CONTACT_GROUPS
  TAGS
  PIPELINE_STAGES
  SPECIFIC_CONTACTS
  ADVANCED_FILTERS
  ALL_CONTACTS
}

enum Platform {
  MESSENGER
  INSTAGRAM
}

enum MessageTag {
  CONFIRMED_EVENT_UPDATE
  POST_PURCHASE_UPDATE
  ACCOUNT_UPDATE
  HUMAN_AGENT
}

model Template {
  id             String       @id @default(cuid())
  name           String
  content        String       @db.Text
  variables      String[]
  platform       Platform
  category       String?
  
  recommendedTag MessageTag?
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  campaigns      Campaign[]
  usageCount     Int          @default(0)
  
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

// ============================================
// MESSAGES & CONVERSATIONS
// ============================================

model Conversation {
  id             String              @id @default(cuid())
  
  contactId      String
  contact        Contact             @relation(fields: [contactId], references: [id], onDelete: Cascade)
  
  facebookPageId String
  facebookPage   FacebookPage        @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)
  
  platform       Platform
  status         ConversationStatus  @default(OPEN)
  lastMessageAt  DateTime
  
  assignedToId   String?
  assignedTo     User?               @relation(fields: [assignedToId], references: [id], onDelete: SetNull)
  
  messages       Message[]
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  
  @@index([status, platform])
  @@index([lastMessageAt])
}

enum ConversationStatus {
  OPEN
  PENDING
  RESOLVED
  ARCHIVED
}

model Message {
  id          String        @id @default(cuid())
  content     String        @db.Text
  platform    Platform
  status      MessageStatus @default(PENDING)
  
  messageTag  MessageTag?
  
  facebookMessageId String?
  
  contactId   String
  contact     Contact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  
  conversationId String?
  conversation   Conversation? @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  campaignId  String?
  campaign    Campaign?     @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  
  isFromBusiness Boolean    @default(true)
  
  sentAt      DateTime?
  deliveredAt DateTime?
  readAt      DateTime?
  failedAt    DateTime?
  errorMessage String?
  
  createdAt   DateTime      @default(now())
  
  @@index([campaignId, status])
  @@index([conversationId, createdAt])
}

enum MessageStatus {
  PENDING
  QUEUED
  SENT
  DELIVERED
  READ
  FAILED
}

// ============================================
// WEBHOOK EVENTS
// ============================================

model WebhookEvent {
  id         String   @id @default(cuid())
  platform   Platform
  eventType  String
  payload    Json
  processed  Boolean  @default(false)
  createdAt  DateTime @default(now())
  
  @@index([processed, createdAt])
}

// ============================================
// SYNC JOBS
// ============================================

model SyncJob {
  id             String    @id @default(cuid())
  facebookPageId String
  status         SyncJobStatus @default(PENDING)
  
  totalContacts  Int       @default(0)
  syncedContacts Int       @default(0)
  failedContacts Int       @default(0)
  
  errors         Json?
  tokenExpired   Boolean   @default(false)
  
  startedAt      DateTime?
  completedAt    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  @@index([facebookPageId, status])
  @@index([status, createdAt])
}

enum SyncJobStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

// ============================================
// TEAM MANAGEMENT SYSTEM
// ============================================

model Team {
  id          String      @id @default(cuid())
  name        String
  description String?
  avatar      String?
  status      TeamStatus  @default(ACTIVE)
  
  // Auto-rotating join code (changes every 10 minutes)
  joinCode    String      @unique
  joinCodeExpiresAt DateTime
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  ownerId     String
  owner       User        @relation("TeamOwner", fields: [ownerId], references: [id])
  
  settings    Json?       // Team-wide settings
  
  members     TeamMember[]
  invites     TeamInvite[]
  activities  TeamActivity[]
  tasks       TeamTask[]
  messages    TeamMessage[]
  threads     TeamThread[]
  broadcasts  TeamBroadcast[]
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  archivedAt  DateTime?
  
  @@index([organizationId])
  @@index([status])
  @@index([joinCode])
}

enum TeamStatus {
  ACTIVE
  PENDING_APPROVAL
  SUSPENDED
  ARCHIVED
}

model TeamMember {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  role        TeamRole @default(MEMBER)
  status      TeamMemberStatus @default(PENDING)
  
  // Activity tracking
  lastActiveAt DateTime?
  totalTimeSpent Int   @default(0) // in seconds
  lastLoginAt    DateTime?
  
  // Permissions
  permissions    TeamMemberPermission[]
  
  // Profile in team context
  displayName    String?
  bio            String?
  
  joinedAt    DateTime  @default(now())
  suspendedAt DateTime?
  suspendedUntil DateTime?
  suspendedReason String?
  
  activities  TeamActivity[]
  assignedTasks TeamTask[] @relation("AssignedTasks")
  createdTasks  TeamTask[] @relation("CreatedTasks")
  sentMessages  TeamMessage[]
  
  @@unique([userId, teamId])
  @@index([teamId, status])
  @@index([userId])
}

enum TeamRole {
  OWNER
  ADMIN
  MANAGER
  MEMBER
}

enum TeamMemberStatus {
  PENDING
  ACTIVE
  SUSPENDED
  REMOVED
}

model TeamMemberPermission {
  id          String   @id @default(cuid())
  
  memberId    String
  member      TeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  // Facebook Page access
  facebookPageId String?
  facebookPage   FacebookPage? @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)
  
  // Feature permissions
  canViewContacts      Boolean @default(true)
  canEditContacts      Boolean @default(false)
  canDeleteContacts    Boolean @default(false)
  
  canViewCampaigns     Boolean @default(true)
  canCreateCampaigns   Boolean @default(false)
  canEditCampaigns     Boolean @default(false)
  canDeleteCampaigns   Boolean @default(false)
  canSendCampaigns     Boolean @default(false)
  
  canViewConversations Boolean @default(true)
  canSendMessages      Boolean @default(false)
  
  canViewPipelines     Boolean @default(true)
  canEditPipelines     Boolean @default(false)
  
  canViewTemplates     Boolean @default(true)
  canEditTemplates     Boolean @default(false)
  
  canViewAnalytics     Boolean @default(true)
  canExportData        Boolean @default(false)
  
  canManageTeam        Boolean @default(false)
  
  customPermissions Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([memberId, facebookPageId])
  @@index([memberId])
}

model TeamInvite {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  code        String   @unique
  type        InviteType @default(CODE)
  
  // For link invites
  inviteLink  String?  @unique
  
  // Expiration
  expiresAt   DateTime?
  maxUses     Int?     @default(1)
  usedCount   Int      @default(0)
  
  // Who created the invite
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])
  
  status      InviteStatus @default(ACTIVE)
  
  // Pending requests
  requests    TeamJoinRequest[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([teamId, status])
  @@index([code])
  @@index([expiresAt])
}

enum InviteType {
  CODE
  LINK
  EMAIL
}

enum InviteStatus {
  ACTIVE
  EXPIRED
  REVOKED
  EXHAUSTED
}

model TeamJoinRequest {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  inviteId    String
  invite      TeamInvite @relation(fields: [inviteId], references: [id], onDelete: Cascade)
  
  status      JoinRequestStatus @default(PENDING)
  
  message     String?  // Optional message from user
  
  reviewedById String?
  reviewedBy   User?   @relation("ReviewedRequests", fields: [reviewedById], references: [id])
  reviewedAt   DateTime?
  reviewNotes  String?
  
  createdAt   DateTime @default(now())
  
  @@index([userId])
  @@index([inviteId, status])
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

model TeamActivity {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  memberId    String?
  member      TeamMember? @relation(fields: [memberId], references: [id], onDelete: SetNull)
  
  type        TeamActivityType
  action      String   // Human-readable action
  
  // What was affected
  entityType  String?  // "contact", "campaign", "message", etc.
  entityId    String?
  entityName  String?
  
  // Additional data
  metadata    Json?
  
  // Tracking
  ipAddress   String?
  userAgent   String?
  duration    Int?     // Time spent on action (seconds)
  
  createdAt   DateTime @default(now())
  
  @@index([teamId, createdAt])
  @@index([memberId, createdAt])
  @@index([type, createdAt])
  @@index([entityType, entityId])
}

enum TeamActivityType {
  LOGIN
  LOGOUT
  VIEW_PAGE
  CREATE_ENTITY
  EDIT_ENTITY
  DELETE_ENTITY
  SEND_MESSAGE
  RECEIVE_MESSAGE
  COMPLETE_TASK
  JOIN_TEAM
  LEAVE_TEAM
  PERMISSION_CHANGED
  EXPORT_DATA
  IMPORT_DATA
  SETTINGS_CHANGED
}

model TeamTask {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  title       String
  description String?  @db.Text
  priority    TaskPriority @default(MEDIUM)
  status      TaskStatus @default(TODO)
  
  assignedToId String?
  assignedTo   TeamMember? @relation("AssignedTasks", fields: [assignedToId], references: [id], onDelete: SetNull)
  
  createdById  String
  createdBy    TeamMember @relation("CreatedTasks", fields: [createdById], references: [id])
  
  // Related entities
  relatedEntityType String?
  relatedEntityId   String?
  
  dueDate     DateTime?
  completedAt DateTime?
  
  tags        String[]
  attachments Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([teamId, status])
  @@index([assignedToId, status])
  @@index([dueDate])
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  IN_REVIEW
  COMPLETED
  CANCELLED
}

model TeamThread {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  title       String?
  type        ThreadType @default(DISCUSSION)
  
  // Group chat participants
  participantIds String[]
  
  isPinned    Boolean  @default(false)
  pinnedAt    DateTime?
  pinnedById  String?
  
  messages    TeamMessage[]
  
  lastMessageAt DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([teamId, lastMessageAt])
  @@index([type])
}

enum ThreadType {
  DIRECT
  GROUP
  DISCUSSION
  ANNOUNCEMENT
}

model TeamMessage {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  threadId    String?
  thread      TeamThread? @relation(fields: [threadId], references: [id], onDelete: Cascade)
  
  senderId    String
  sender      TeamMember @relation(fields: [senderId], references: [id])
  
  content     String   @db.Text
  
  // Mentions
  mentions    String[] // Member IDs
  
  // Reactions
  reactions   Json?    // {emoji: [memberIds]}
  
  // Attachments
  attachments Json?
  
  // Reply thread
  replyToId   String?
  replyTo     TeamMessage? @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies     TeamMessage[] @relation("MessageReplies")
  
  isEdited    Boolean  @default(false)
  editedAt    DateTime?
  
  isDeleted   Boolean  @default(false)
  deletedAt   DateTime?
  
  // Read receipts
  readBy      String[] // Member IDs who have read
  
  createdAt   DateTime @default(now())
  
  @@index([teamId, createdAt])
  @@index([threadId, createdAt])
  @@index([senderId])
}

model TeamBroadcast {
  id          String   @id @default(cuid())
  
  teamId      String
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  title       String
  content     String   @db.Text
  priority    BroadcastPriority @default(NORMAL)
  
  senderId    String
  sender      User     @relation(fields: [senderId], references: [id])
  
  targetRole  TeamRole? // If null, send to all
  
  isPinned    Boolean  @default(false)
  pinnedUntil DateTime?
  
  // Scheduling
  scheduledFor DateTime?
  sentAt       DateTime?
  
  // Tracking
  readBy      String[] // User IDs
  
  attachments Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([teamId, sentAt])
  @@index([isPinned])
}

enum BroadcastPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

